
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator Angka FINAL ABSOLUTE COMPLETE V3</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_3DFpfBEwr7LVoYpfrHj5crtWqj9O2rk",
  authDomain: "generator-angka-cloud.firebaseapp.com",
  projectId: "generator-angka-cloud"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

async function checkDeviceLock(user){
  let deviceId = localStorage.getItem("device_id");
  if(!deviceId){
    deviceId = crypto.randomUUID();
    localStorage.setItem("device_id", deviceId);
  }

  const ref = doc(db, "userDevices", user.uid);
  const snap = await getDoc(ref);

  if(!snap.exists()){
    await setDoc(ref, { deviceId: deviceId });
    return true;
  }

  if(snap.data().deviceId !== deviceId){
    alert("Akun sudah aktif di device lain!");
    await signOut(auth);
    return false;
  }

  return true;
}

window.loginUser = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  try{
    const cred = await signInWithEmailAndPassword(auth, email, password);
    const allowed = await checkDeviceLock(cred.user);
    if(!allowed) return;

    document.getElementById("loginBox").style.display="none";
    document.getElementById("appBox").style.display="block";
  }catch(e){
    alert("Login gagal");
  }
}

function eliteNext(value){
  let prefix = value.replace(/\d+$/, "");
  let match = value.match(/\d+$/);
  if(!match) return value;

  let fullNum = match[0];
  let len = fullNum.length;
  let num = parseInt(fullNum);

  let last4 = num % 10000;
  let last2 = num % 100;

  if(last2 >= 40 && last2 <= 49){
    num += 17;
  }
  else if(last4 >= 990 && last4 <= 999){
    let ribuan = Math.floor(last4 / 1000);
    if(ribuan === 4){
      num += 15;
    }else{
      num += 16;
    }
  }
  else{
    num += 8;
  }

  return prefix + num.toString().padStart(len,'0');
}

window.generateNumbers = function(){
  const start = document.getElementById("startNumber").value.trim();
  const count = parseInt(document.getElementById("count").value);

  let current = start;
  let result = "";

  for(let i=0;i<count;i++){
    result += current + "\n";
    current = eliteNext(current);
  }

  document.getElementById("result").value = result;
}

window.copyResult = function(){
  const textarea = document.getElementById("result");
  textarea.select();
  document.execCommand("copy");
  alert("Hasil disalin!");
}

</script>

<style>
body{
  font-family: Arial;
  background:#f4f6f9;
  margin:0;
  padding:15px;
}

.card{
  background:white;
  padding:20px;
  border-radius:12px;
  max-width:500px;
  margin:auto;
  box-shadow:0 5px 20px rgba(0,0,0,0.1);
}

input, textarea, button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button{
  background:#1e88e5;
  color:white;
  border:none;
  font-weight:bold;
}

textarea{
  height:250px;
}

.title{
  text-align:center;
  font-weight:bold;
  font-size:18px;
}
</style>
</head>

<body>

<div class="card" id="loginBox">
<div class="title">LOGIN</div>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="loginUser()">Login</button>
</div>

<div class="card" id="appBox" style="display:none;">
<div class="title">GENERATOR ANGKA FINAL ABSOLUTE COMPLETE V3</div>
<input type="text" id="startNumber" placeholder="Contoh: 07KJ0010005">
<input type="number" id="count" placeholder="Jumlah (1000 dll)">
<button onclick="generateNumbers()">Generate</button>
<button onclick="copyResult()">Salin Hasil</button>
<textarea id="result"></textarea>
</div>

</body>
</html>
